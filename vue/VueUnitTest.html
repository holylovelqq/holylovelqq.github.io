<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VUE-UnitTest | 瓜田李下</title>
    <meta name="description" content="个人博客">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.d2702d17.css" as="style"><link rel="preload" href="/assets/js/app.53e1efa5.js" as="script"><link rel="preload" href="/assets/js/3.e0b6caec.js" as="script"><link rel="preload" href="/assets/js/29.84856ba3.js" as="script"><link rel="prefetch" href="/assets/js/10.56b39b65.js"><link rel="prefetch" href="/assets/js/11.fee41aa4.js"><link rel="prefetch" href="/assets/js/12.12965bd3.js"><link rel="prefetch" href="/assets/js/13.3364c8ee.js"><link rel="prefetch" href="/assets/js/14.4e68a02e.js"><link rel="prefetch" href="/assets/js/15.6517517f.js"><link rel="prefetch" href="/assets/js/16.7e67e97f.js"><link rel="prefetch" href="/assets/js/17.8c5d4496.js"><link rel="prefetch" href="/assets/js/18.3d81c598.js"><link rel="prefetch" href="/assets/js/19.e0890521.js"><link rel="prefetch" href="/assets/js/20.c8f50aa8.js"><link rel="prefetch" href="/assets/js/21.645f12c9.js"><link rel="prefetch" href="/assets/js/22.5121e040.js"><link rel="prefetch" href="/assets/js/23.1e81ce53.js"><link rel="prefetch" href="/assets/js/24.41a35b8d.js"><link rel="prefetch" href="/assets/js/25.991f9ad3.js"><link rel="prefetch" href="/assets/js/26.868eb5b6.js"><link rel="prefetch" href="/assets/js/27.bd14c6cd.js"><link rel="prefetch" href="/assets/js/28.bf6f57f0.js"><link rel="prefetch" href="/assets/js/30.c9661a6a.js"><link rel="prefetch" href="/assets/js/4.fa413b61.js"><link rel="prefetch" href="/assets/js/5.2254426d.js"><link rel="prefetch" href="/assets/js/6.7282fe9a.js"><link rel="prefetch" href="/assets/js/7.9a0ef780.js"><link rel="prefetch" href="/assets/js/8.65f6b4fc.js"><link rel="prefetch" href="/assets/js/9.39cf308d.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.ae38f3e0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d2702d17.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">瓜田李下</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vue/" class="nav-link router-link-active">vue</a></div><div class="nav-item"><a href="/frondend/" class="nav-link">前端知识</a></div><div class="nav-item"><a href="/server/" class="nav-link">服务器部署</a></div><div class="nav-item"><a href="/life/" class="nav-link">无关技术</a></div> <a href="https://github.com/holylovelqq" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vue/" class="nav-link router-link-active">vue</a></div><div class="nav-item"><a href="/frondend/" class="nav-link">前端知识</a></div><div class="nav-item"><a href="/server/" class="nav-link">服务器部署</a></div><div class="nav-item"><a href="/life/" class="nav-link">无关技术</a></div> <a href="https://github.com/holylovelqq" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/vue/VueCommon.html" class="sidebar-link">VUE踩坑总结</a></li><li><a href="/vue/VueUnitTest.html" class="active sidebar-link">VUE-UnitTest</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/VueUnitTest.html#为什么要写单元测试" class="sidebar-link">为什么要写单元测试</a></li><li class="sidebar-sub-header"><a href="/vue/VueUnitTest.html#本文提到的单元测试" class="sidebar-link">本文提到的单元测试</a></li><li class="sidebar-sub-header"><a href="/vue/VueUnitTest.html#常用的断言语句" class="sidebar-link">常用的断言语句</a></li><li class="sidebar-sub-header"><a href="/vue/VueUnitTest.html#项目结构" class="sidebar-link">项目结构</a></li><li class="sidebar-sub-header"><a href="/vue/VueUnitTest.html#单元测试的写法" class="sidebar-link">单元测试的写法</a></li></ul></li><li><a href="/vue/VueAPP.html" class="sidebar-link">VUE原生APP制作</a></li><li><a href="/vue/VueNuxtTS.html" class="sidebar-link">Vue+NuxtJS+TS</a></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="vue-unittest"><a href="#vue-unittest" aria-hidden="true" class="header-anchor">#</a> VUE-UnitTest</h1> <ul><li>本文将大致介绍vue单元测试的写法，详细请参考github代码<a href="https://github.com/holylovelqq/vue-unit-test-with-jest" target="_blank" rel="noopener noreferrer">仓库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>单元测试写法参考<a href="https://vue-test-utils.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">Vue Test Utils<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,这是vue官方的单元测试实用工具库</li> <li>使用的是<a href="https://jestjs.io/docs/zh-Hans/getting-started" target="_blank" rel="noopener noreferrer">jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,Facebook 开发的测试运行器</li> <li>本文的想定读者：使用vue作为项目的开发框架，对vue有一定的理解，要写单元测试</li> <li>开发环境，需要特别指出
<ul><li>Vue-Cli：v3.3.0</li> <li>&quot;vue&quot;: &quot;^2.6.6&quot;</li></ul></li></ul> <p>其他，请参见package.json文件</p> <ul><li>特别说明
<ul><li><strong>免责声明</strong>
本文以学习交流、技术分享为目的，因为本文内容对您产生困扰或者造成损失，笔者概不负责</li> <li><strong>版权声明</strong>
未经笔者同意不得用于商业用途，违者必究。个人引用请标明出处</li></ul></li></ul> <h2 id="为什么要写单元测试"><a href="#为什么要写单元测试" aria-hidden="true" class="header-anchor">#</a> 为什么要写单元测试</h2> <p>组件的单元测试有很多好处：</p> <ol><li>提供描述组件行为的文档</li> <li>节省手动测试的时间</li> <li>减少研发新特性时产生的 bug</li> <li>改进设计</li> <li>促进重构</li></ol> <p>自动化测试使得大团队中的开发者可以维护复杂的基础代码。</p> <p>以上是官方说法，就个人而言，除了以上的好处以外，单元测试还能够</p> <ul><li>规范代码</li> <li>个人成就感，100%测试覆盖率（装b利器）</li> <li>全周期工程师必备技能（设计-编程-测试-release-部署-维护）</li> <li>如果项目是个人项目，个人测试是不可或缺的（你难道不想有一个自己的项目么）</li></ul> <h2 id="本文提到的单元测试"><a href="#本文提到的单元测试" aria-hidden="true" class="header-anchor">#</a> 本文提到的单元测试</h2> <h3 id="template标签内"><a href="#template标签内" aria-hidden="true" class="header-anchor">#</a> Template标签内</h3> <p>本标签内主要是DOM结构，可以使用jest的snapshot功能进行测试，也可进行精确测试，即断言某DOM元素存在与否</p> <ul><li>v-on（依赖函数存在于script标签内）</li> <li>v-bind（依赖变量存在于script标签内）</li> <li>slot（vue2.6.0以上版本更新了此语法，本文完成时并未影响到测试）</li> <li>v-if/v-show（依赖变量存在于script标签内）</li> <li>filter（依赖函数存在于script标签内）</li></ul> <p>测试要配合script标签的内容进行</p> <h3 id="script标签"><a href="#script标签" aria-hidden="true" class="header-anchor">#</a> Script标签</h3> <p>本标签内主要是逻辑实现，可能出现的内容有</p> <ul><li>Props（⭐必须进行测试）</li> <li>Data（一般配合v-bind/v-if/v-show等一起测试）</li> <li>Filters（⭐必须进行测试）</li> <li>Methods（⭐必须进行测试）</li> <li>$emit（⭐必须进行测试）</li> <li>eventHub（空vue实例，用于分发事件，在使用的组件内进行测试）</li> <li>watch（⭐必须进行测试）</li> <li>computed（⭐必须进行测试）</li> <li>router（⭐必须进行测试）</li> <li>axios（⭐必须进行测试）</li> <li>vuex（⭐必须进行测试）</li></ul> <p>其他插件：element-ui/momentJS等插件本身不需要我们进行测试，开发者已经测试过，但是被测试组件如果使用了此插件的话，需要我们挂载在临时vue上，避免测试时报错</p> <h2 id="常用的断言语句"><a href="#常用的断言语句" aria-hidden="true" class="header-anchor">#</a> 常用的断言语句</h2> <ul><li>toBe()----测试具体的值</li> <li>toEqual()----测试对象类型的值</li> <li>toBeCalled()----测试函数被调用</li> <li>toHaveBeenCalledTimes()----测试函数被调用的次数</li> <li>toHaveBeenCalledWith()----测试函数被调用时的参数</li> <li>toBeNull()----结果是null</li> <li>toBeUndefined()----结果是undefined</li> <li>toBeDefined()----结果是defined</li> <li>toBeTruthy()----结果是true</li> <li>toBeFalsy()----结果是false</li> <li>toContain()----数组匹配，检查是否包含</li> <li>toMatch()----匹配字符型规则，支持正则</li> <li>toBeCloseTo()----浮点数</li> <li>toThrow()----支持字符串，浮点数，变量</li> <li>toMatchSnapshot()----jest特有的快照测试</li> <li>.not.+matcher，eg. .not.toBe()----前面加上.not就是否定形式，</li></ul> <p>以上只是一部分matcher，更多请查看<a href="https://jestjs.io/docs/zh-Hans/expect#expectextendmatchers" target="_blank" rel="noopener noreferrer">jest官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="项目结构"><a href="#项目结构" aria-hidden="true" class="header-anchor">#</a> 项目结构</h2> <p>一目了然的文件树结构，能给人一种逻辑清晰的第一印象，体现了开发者的基本素养</p> <p>下面是作者的文件分类方式</p> <h3 id="组件分类"><a href="#组件分类" aria-hidden="true" class="header-anchor">#</a> 组件分类</h3> <p>组件分类不仅有利于测试，更重要的是性能优化，组件尽可能分类细化有利于快速更新视图、渲染页面、提高用户体验</p> <p>前端组件分类一般分为两类</p> <ul><li>Presentation Component</li> <li>Container Component</li></ul> <h4 id="presentation-component"><a href="#presentation-component" aria-hidden="true" class="header-anchor">#</a> Presentation Component</h4> <p>这类组件的主要功能是DOM展示，数据一般是通过props获取数据，然后展示出来</p> <p>基本特征：</p> <ul><li>不依赖其他组件，与store和router无关联</li> <li>不进行CRUD操作（如果必要可使用$emit在夫组件内操作）</li> <li>尽量不使用生命周期函数</li> <li>尽量具有可复用性</li></ul> <h4 id="container-component"><a href="#container-component" aria-hidden="true" class="header-anchor">#</a> Container Component</h4> <p>这类组件的主要功能是数据操作（API联调）</p> <p>基本特征：</p> <ul><li>子组件的状态改变（props、$emit）</li> <li>CRUD操作、store内数据操作、router切换</li></ul> <h3 id="文件树构成"><a href="#文件树构成" aria-hidden="true" class="header-anchor">#</a> 文件树构成</h3> <p>基于组件分类方式，把不同的组件放在不同的文件夹内</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>-src
  -assets------CSS，JS，image，icon
  -basics------基础组件（不含其他组件，便于复用）
  -components--大型组件（含其他组件，会被复用）
  -containers--容器组件（包含其他组件，不会被复用，数据处理，通常用于复杂页面分担views压力）
  -views--------页面组件（路由切换使用，展示页面用，数据处理）
    -App.vue
  -main.js
...其他
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>下面相应讲解一下每个文件夹内对应的组件类别</p> <ul><li>Bsics文件夹内存放的一般是最小的组件单元和可复用的组件，比如：按钮组件AppButton.vue、输入框组件AppInput.vue 等等，属于presentation component</li> <li>Components文件夹内存放的是集合了basics或者components组件的父组件，属于presentation component</li> <li>Containers文件夹内存放的是比自身组件小的组件basics或者components组件的父组件，主要是给子组件传递props等数据，属于containers component</li> <li>views文件夹内存放的是页面组件，内涵页面内所有子组件，主要是操作数据和路由切换，属于containers component</li></ul> <p>※ <em><strong>实际请根据项目的需求构建自己的文件树</strong></em></p> <h2 id="单元测试的写法"><a href="#单元测试的写法" aria-hidden="true" class="header-anchor">#</a> 单元测试的写法</h2> <p>以下会列举一些单元测试的写法，源码来自于github<a href="https://github.com/holylovelqq/vue-unit-test-with-jest" target="_blank" rel="noopener noreferrer">仓库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，.vue文件并未展示，如遇不理解之处请参考源码</p> <h3 id="snapshot测试"><a href="#snapshot测试" aria-hidden="true" class="header-anchor">#</a> Snapshot测试</h3> <p>目前来说是jest专有的测试方法，测试整体的html有没有更改，每一个文件都应该进行该测试。</p> <p>※ 更改html后，该测试会失败，删除保存在__snapshots__文件夹内对应的.snap文件后，重新测试（或者根据实际情况在测试命令后加 -u）</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 测试内容：snapshot-&gt;概括的测试DOM结构</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'matches snapshot'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>AppButton<span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  wrapper<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="精确dom结构测试"><a href="#精确dom结构测试" aria-hidden="true" class="header-anchor">#</a> 精确DOM结构测试</h3> <p>断言指定节点对象是否存在，视项目情况而定需不需要进行此测试</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 测试内容：精准DOM结构测试示例</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'DOM test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>AppButton<span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  wrapper<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="v-on"><a href="#v-on" aria-hidden="true" class="header-anchor">#</a> v-on</h3> <ul><li>以click事件为例</li> <li>测试思路：点击，断言对应函数是否被触发，触发几次，参数是否为预期参数（如果有参数）</li> <li>注意被断言的函数必须为mock函数，不然会报错</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/** 测试内容：func测试
  *点击按钮组件时，正确触发点击事件
*/</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'click button onClick is clled'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>AppButton<span class="token punctuation">)</span>
  <span class="token comment">// 创建mock函数</span>
  <span class="token keyword">const</span> mockFn <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 设置 Wrapper vm 的方法并强制更新。</span>
  wrapper<span class="token punctuation">.</span><span class="token function">setMethods</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  onClick<span class="token punctuation">:</span>mockFn
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 获取buttonDOM元素</span>
  <span class="token keyword">const</span> button <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>
  <span class="token comment">// 测试点击按钮后有没有正确触发函数</span>
  button<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
  <span class="token comment">// 断言函数被触发，且被触发一次</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockFn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockFn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

  wrapper<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="v-bind-data"><a href="#v-bind-data" aria-hidden="true" class="header-anchor">#</a> v-bind(Data)</h3> <p>大多数情况下都可以不写此测试</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * 测试内容：data v-bind
 * 断言data中变量的值
*/</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'data test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 断言默认值</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>collapse<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 更改后</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'holy'</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.el-dropdown-link'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'holy'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="slot"><a href="#slot" aria-hidden="true" class="header-anchor">#</a> slot</h3> <ul><li><p>vue2.6.0以上版本更新了此语法，本文完成时并未影响到测试</p></li> <li><p>slots分为普通插槽、具名插槽和作用域插槽，以下分别示例</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * 测试内容：slots 普通插槽
 * 测试默认值（当slot有默认值时）
*/</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'slots default value test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>AppButton<span class="token punctuation">)</span>
  <span class="token keyword">const</span> button <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>button<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'submit'</span><span class="token punctuation">)</span>
  wrapper<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/** 测试内容：slots 普通插槽
 * mount时传入自定义的内容作为slots，然后再断言自定义的内容存在与否
 * 自定义的内容可能会是text，html，componets等允许的内容
*/</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'slots test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>AppButton<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    slots<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span><span class="token string">'i am slots text'</span><span class="token comment">// 自定义slots内容</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> button <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>button<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'i am slots text'</span><span class="token punctuation">)</span>

  wrapper<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/** 测试内容：slots具名插槽
 * vue2.6更新后的新语法v-slots，3.0中会延续使用，并废除旧语法
 * 测试方法与slots普通插槽相同，此处传入为html,
 * 当传入组件时，只需断言wrapper中是否包含组件的DOM元素即可
 * expect(wrapper.contains('.container')).toBe(true)
*/</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'named slots test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>AppButton<span class="token punctuation">,</span> <span class="token punctuation">{</span>
slots<span class="token punctuation">:</span> <span class="token punctuation">{</span>
namedSlot<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`&lt;span&gt;i am slots html&lt;/span&gt;`</span></span><span class="token comment">// 自定义slots内容</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> button <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>button<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> span <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button span'</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>span<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'i am slots html'</span><span class="token punctuation">)</span>

wrapper<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/** 测试内容：slots作用域插槽
 * vue2.6更新后的新语法v-slots，3.0中会延续使用，并废除旧语法
 * 测试方法与slots具名插槽相同，此处传入为html,
 * 当传入组件时，只需断言wrapper中是否包含组件的DOM元素即可
 * expect(wrapper.contains('.container')).toBe(true)
*/</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'scoped slots test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>AppButton<span class="token punctuation">,</span> <span class="token punctuation">{</span>
scopedSlots<span class="token punctuation">:</span> <span class="token punctuation">{</span>
scopedSlot<span class="token punctuation">:</span><span class="token template-string"><span class="token string">`&lt;span slot-scope=&quot;foo&quot;&gt;{{ foo.user.lastName }}&lt;/span&gt;`</span></span><span class="token comment">// 自定义slots内容</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> button <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>button<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
constspan <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button span'</span><span class="token punctuation">)</span>
<span class="token function">expect</span><span class="token punctuation">(</span>span<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'holy'</span><span class="token punctuation">)</span>

wrapper<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><h3 id="v-if-v-show"><a href="#v-if-v-show" aria-hidden="true" class="header-anchor">#</a> v-if/v-show</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * 测试内容：v-show/v-if测试，与v-bind的测试思路基本相同
 * 设置变量的值，断言对应的DOM结构显示与否
*/</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'v-show test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// true时显示的div</span>
  <span class="token keyword">const</span> truediv <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.text.format'</span><span class="token punctuation">)</span>
  <span class="token comment">// false时显示的div</span>
  <span class="token keyword">const</span> falsediv <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.text.noformat'</span><span class="token punctuation">)</span>
  <span class="token comment">// toggleShow默认值为true</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>truediv<span class="token punctuation">.</span><span class="token function">isVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>falsediv<span class="token punctuation">.</span><span class="token function">isVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token comment">// 设置为false</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>toggleShow <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>truediv<span class="token punctuation">.</span><span class="token function">isVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>falsediv<span class="token punctuation">.</span><span class="token function">isVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="filter过滤器"><a href="#filter过滤器" aria-hidden="true" class="header-anchor">#</a> filter过滤器</h3> <ul><li>过滤器的测试与其他略有不同，参见下方代码</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount<span class="token punctuation">,</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> FilterTest <span class="token keyword">from</span> <span class="token string">'@/components/FilterTest.vue'</span>
<span class="token operator">...</span>
<span class="token operator">...</span>
<span class="token operator">...</span>
<span class="token comment">/** 测试内容：filter过滤器
 * filter不能通过wrapper或者vm获取，只能通过组件获取
 * filter需要测试函数的所有可能性
*/</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'filter test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(FilterTest.filters)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>FilterTest<span class="token punctuation">.</span>filters<span class="token punctuation">.</span><span class="token function">formatText</span><span class="token punctuation">(</span><span class="token string">'12345678'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'12...78'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>FilterTest<span class="token punctuation">.</span>filters<span class="token punctuation">.</span><span class="token function">formatText</span><span class="token punctuation">(</span><span class="token string">'12345'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'12345'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>FilterTest<span class="token punctuation">.</span>filters<span class="token punctuation">.</span><span class="token function">formatText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="props"><a href="#props" aria-hidden="true" class="header-anchor">#</a> props</h3> <ul><li>复杂组件的props也会较复杂，但只要思路清晰，套路都是一样的</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/** 测试内容：props
 * 自定义props传递给AppButton组件，判断组件有获取到props
 * 请注意props是否存在默认值
*/</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'props test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> buttonProps <span class="token operator">=</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span><span class="token string">'danger'</span><span class="token punctuation">,</span>
    size<span class="token punctuation">:</span><span class="token string">'lg'</span><span class="token punctuation">,</span>
    disabled<span class="token punctuation">:</span><span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>AppButton<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    propsData<span class="token punctuation">:</span>buttonProps
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 断言已经获取到props</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">props</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'lg'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">props</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'danger'</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">props</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>disabled<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token comment">// 每个it最后都应该销毁wrapper</span>
  wrapper<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="methods（func函数测试）"><a href="#methods（func函数测试）" aria-hidden="true" class="header-anchor">#</a> Methods（func函数测试）</h3> <ul><li>主动触发函数，断言执行结果是否符合预期</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/** 测试内容：changeShow()函数
 * changeShow()函数被调用时，能正确执行
*/</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'called changeShow()'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 手动将变量的值设置为false,默认值是true</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>toggleShow <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token comment">// 执行函数</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">changeShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 期望结果</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>toggleShow<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token comment">// 再次执行函数</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">changeShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 期望结果</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>toggleShow<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="emit"><a href="#emit" aria-hidden="true" class="header-anchor">#</a> $emit</h3> <ul><li>子组件内触发父组件内的函数，组件结构越复杂，使用的越多</li> <li>区别于eventHub，此$emit非彼$emit</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/** 测试内容：$emit
 * 包含$emit的函数被触发后，emit的函数也会被触发
*/</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'when onClick is called $emit is called'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>AppButton<span class="token punctuation">)</span>
  <span class="token comment">// 测试$emmit函数被正确触发</span>
  <span class="token comment">// mock函数替代点击按钮后$emit的函数，此处函数名相同，依然为click</span>
  <span class="token keyword">const</span> mockFn1 <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> mockFn1<span class="token punctuation">)</span>
  <span class="token comment">// 测试mock函数是否被触发，触发的次数,以及参数</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockFn1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockFn1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockFn1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'i am params'</span><span class="token punctuation">)</span>
  <span class="token comment">// 第二次点击button，依然测试mock函数是否被触发，触发的次数</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockFn1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockFn1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockFn1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'i am params'</span><span class="token punctuation">)</span>

  wrapper<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="watch"><a href="#watch" aria-hidden="true" class="header-anchor">#</a> watch</h3> <ul><li>下例内，侦听器内仅执行了console.log()</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/** 测试内容：watch
 * 更改watch的data的值，断言操作是否与预期相同
*/</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'watch test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// mock掉console.log</span>
  <span class="token keyword">const</span> spy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>console<span class="token punctuation">,</span><span class="token string">'log'</span><span class="token punctuation">)</span>
  <span class="token comment">// 手动将变量的值设置为false,默认值是true</span>
  wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>toggleShow <span class="token operator">=</span> <span class="token string">'自定义'</span>
  <span class="token comment">// 断言函数是否执行</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">'自定义'</span><span class="token punctuation">)</span>
  <span class="token comment">// 清除掉mock</span>
  spy<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="computed"><a href="#computed" aria-hidden="true" class="header-anchor">#</a> computed</h3> <p>⭐要注意计算属性不是函数，是变量，测试时很容易看着组件内写法按照函数测试</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/** 测试内容：computed
 * 要注意计算属性不是函数，是变量，测试时很容易看着组件内写法按照函数测试
 * 改变props的type，size，disable值时，cssClasses的值也会跟着改变
*/</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'computed test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>AppButton<span class="token punctuation">)</span>
  <span class="token comment">// 设置props 断言computed计算属性（注意props有default值）</span>
  wrapper<span class="token punctuation">.</span><span class="token function">setProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span><span class="token string">'danger'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>cssClasses<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'app-button app-button--md app-button--danger'</span><span class="token punctuation">)</span>
  wrapper<span class="token punctuation">.</span><span class="token function">setProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span> size<span class="token punctuation">:</span><span class="token string">'lg'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>cssClasses<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'app-button app-button--lg app-button--danger'</span><span class="token punctuation">)</span>
  wrapper<span class="token punctuation">.</span><span class="token function">setProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span> disabled<span class="token punctuation">:</span><span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>cssClasses<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'app-button app-button--lg app-button--disabled'</span><span class="token punctuation">)</span>

  wrapper<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="router"><a href="#router" aria-hidden="true" class="header-anchor">#</a> router</h3> <ul><li>本文建议使用mock的$route和$router</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> RouterTest <span class="token keyword">from</span> <span class="token string">'@/components/RouterTest.vue'</span>

<span class="token comment">/** vue-router测试
 * 不建议直接在localVue上挂载vue-router
 * 使用mock的$route和$router更加灵活，方便测试
*/</span>
<span class="token keyword">const</span> $route <span class="token operator">=</span> <span class="token punctuation">{</span>
  path<span class="token punctuation">:</span><span class="token string">'/some'</span>
  <span class="token comment">// ...其他属性</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> mockPush <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> $router <span class="token operator">=</span> <span class="token punctuation">{</span>
  push<span class="token punctuation">:</span>mockPush
  <span class="token comment">// ... 其他属性</span>
<span class="token punctuation">}</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'RouterTest.vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// wrapper.vm是组件实例，包含该实例的所有方法和属性</span>
  letwrapper
  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>RouterTest<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  stubs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'app-button'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  mocks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  $route<span class="token punctuation">,</span>
  $router
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  wrapper<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 测试内容：goVIPs()被调用-&gt;触发mock的push函数</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'goVIPs() is called'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 执行函数</span>
    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">goVIPs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 期望结果</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>mockPush<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h3 id="axios"><a href="#axios" aria-hidden="true" class="header-anchor">#</a> axios</h3> <ol><li>mock掉整个axios，返回值可以在此时定义也可以在使用时定义</li> <li>.vue文件内使用axios函数内需要配合添加return，便于测试</li> <li>reject的情况也需要测试</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * AxiosTest.vue组件
 * 测试内容包括以下
 * 自定义func
 * axios
 */</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount<span class="token punctuation">,</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> AxiosTest <span class="token keyword">from</span> <span class="token string">'@/components/AxiosTest.vue'</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>

<span class="token comment">// mock掉整个axios模块</span>
<span class="token comment">// 返回值在使用的时候自定义</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>

<span class="token comment">// 创建临时Vue实例，挂载组件中使用的插件</span>
<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
localVue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$axios <span class="token operator">=</span> axios<span class="token comment">// 挂载axios</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'AxiosTest.vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> wrapper
  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  axios<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>AxiosTest<span class="token punctuation">,</span> <span class="token punctuation">{</span> localVue<span class="token punctuation">,</span>
  stubs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'app-button'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  wrapper<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 测试内容：func -&gt;getData()</span>
  <span class="token comment">// 点击按钮函数被触发(注意此处的click事件是子组件(按钮组件$emit)的事件,</span>
  <span class="token comment">// 在父组件内不属于DOM原生事件,所以触发方式不能使用trigger,而应该使用$emit)</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'when button is clicked getData will be called'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 创建mock函数</span>
    <span class="token keyword">const</span> mockFn <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 设置 Wrapper vm 的方法并强制更新。</span>
    wrapper<span class="token punctuation">.</span><span class="token function">setMethods</span><span class="token punctuation">(</span><span class="token punctuation">{</span> getData<span class="token punctuation">:</span>mockFn <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 获取对应按钮</span>
    <span class="token keyword">const</span> axiosButton <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.axios app-button-stub'</span><span class="token punctuation">)</span>
    <span class="token comment">// 点击按钮-&gt;注意触发方式不能使用trigger</span>
    axiosButton<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
    <span class="token comment">// 断言函数被触发且只触发一次</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>mockFn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>mockFn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 测试内容：axios-&gt;getData()函数</span>
  <span class="token comment">// 为了配合axios测试,需要在组件代码的两处增加return,参见AxiosTest组件</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'axios test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 此处只是使用了get,post/patch/delete/...与get相同</span>
    <span class="token comment">// 自定义get的返回值</span>
    <span class="token keyword">const</span> mockData <span class="token operator">=</span> <span class="token punctuation">{</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span><span class="token string">'Bob'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
    axios<span class="token punctuation">.</span>get<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span>mockData<span class="token punctuation">)</span>
    <span class="token keyword">return</span> wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>mockData<span class="token punctuation">)</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>usersInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>mockData<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 测试内容：axios-&gt;getData()函数请求rejeced的情况</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'axios test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 自定义get被拒绝时返回值</span>
    axios<span class="token punctuation">.</span>get<span class="token punctuation">.</span><span class="token function">mockRejectedValue</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token function">expect</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatch</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><h3 id="vuex"><a href="#vuex" aria-hidden="true" class="header-anchor">#</a> vuex</h3> <ul><li>伪造vuex内的所有</li> <li>测试伪造的函数能否被正确触发</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * VuexTest.vue组件
 * 测试内容包括以下
* 临时vue实例上挂载element-ui
 * func
 * vuex store内的state mutations actions getters
 */</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount<span class="token punctuation">,</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> VuexTest <span class="token keyword">from</span> <span class="token string">'@/components/VuexTest.vue'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>

<span class="token comment">// 创建临时Vue实例，挂载组件中使用的插件</span>
<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'VuexTest.vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// wrapper.vm是组件实例，包含该实例的所有方法和属性</span>
  <span class="token keyword">let</span> wrapper
  <span class="token keyword">let</span> actions
  <span class="token keyword">let</span> state
  <span class="token keyword">let</span> getters
  <span class="token keyword">let</span> mutations
  <span class="token keyword">let</span> store
  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 伪造actions state getters mutations</span>
    actions <span class="token operator">=</span> <span class="token punctuation">{</span>
      increment<span class="token punctuation">:</span>jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      decrement<span class="token punctuation">:</span>jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    mutations <span class="token operator">=</span> <span class="token punctuation">{</span>
      increment<span class="token punctuation">:</span>jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      decrement<span class="token punctuation">:</span>jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    state <span class="token operator">=</span> <span class="token punctuation">{</span>
      count<span class="token punctuation">:</span><span class="token number">0</span>
    <span class="token punctuation">}</span>
    getters <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">evenOrOdd</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token string">'gettersVal'</span><span class="token comment">// 伪造的越简单越好</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 伪造store</span>
    store <span class="token operator">=</span> newVuex<span class="token punctuation">.</span><span class="token function">Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      state<span class="token punctuation">,</span>
      actions<span class="token punctuation">,</span>
      mutations<span class="token punctuation">,</span>
      getters
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 挂载store</span>
    wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>VuexTest<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      localVue<span class="token punctuation">,</span>
      store<span class="token punctuation">,</span>
      stubs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'app-button'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wrapper<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 测试内容：state</span>
  <span class="token comment">// 只需测试伪造的state值是否存在于dom中</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'getters test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> text <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.text'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 测试内容：actions-通过点击按钮直接调用</span>
  <span class="token comment">// 点击按钮测试伪造的函数是否被调用</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'actions test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> buttonAdd <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.add'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> buttonMinus <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.minus'</span><span class="token punctuation">)</span>
    buttonAdd<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>increment<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>increment<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    buttonMinus<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>decrement<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>decrement<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 测试内容：dispatchIncrement()</span>
  <span class="token comment">// 点击按钮测试函数dispatchIncrement()是否被调用</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'dispatchIncrement test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dispatchAdd <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.dispatchAdd'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> mockAdd <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span><span class="token function">setMethods</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      dispatchIncrement<span class="token punctuation">:</span>mockAdd
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    dispatchAdd<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>mockAdd<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>mockAdd<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 测试内容：actions--通过dispatch调用</span>
  <span class="token comment">// 调用函数测试伪造的函数是否被调用</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'dispatch actions test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">dispatchIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>increment<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>increment<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 测试内容：mutationsDecrement()</span>
  <span class="token comment">// 点击按钮测试函数mutationsDecrement()是否被调用</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'mutationsDecrement test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> mutationsMinus <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.mutationsMinus'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> mockMinus <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    wrapper<span class="token punctuation">.</span><span class="token function">setMethods</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      mutationsDecrement<span class="token punctuation">:</span>mockMinus
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    mutationsMinus<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>mockMinus<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>mockMinus<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 测试内容：mutations</span>
  <span class="token comment">// 调用函数测试伪造的函数是否被调用</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'mutations test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">mutationsDecrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>mutations<span class="token punctuation">.</span>decrement<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>mutations<span class="token punctuation">.</span>decrement<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 测试内容：getters</span>
  <span class="token comment">// 只需测试伪造的getters值是否存在于dom中</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'getters test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> text <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.text'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span>getters<span class="token punctuation">.</span><span class="token function">evenOrOdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br></div></div><h3 id="store-js"><a href="#store-js" aria-hidden="true" class="header-anchor">#</a> store.js</h3> <ul><li>测试vuex内的各个函数</li> <li>当测试其中任一函数时，其他依赖全部使用mock函数</li> <li>该测试方法为官方推荐方法之一，官方推荐了两种测试方法，各有优劣，详情参阅<a href="https://vue-test-utils.vuejs.org/zh/guides/#%E5%9C%A8%E7%BB%84%E4%BB%B6%E4%B8%AD%E6%B5%8B%E8%AF%95-vuex" target="_blank" rel="noopener noreferrer">官方说明<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/**
 * store.js
 * 测试内容包括以下
 * 测试思路：mutations/getters/actions 分别测试，测试其中一个的时候，其他依赖伪造mock
* 本质还是测试方法（官网列出了两种测试方法，我们选择简单易懂便于测试的）
*/</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mutations<span class="token punctuation">,</span> getters<span class="token punctuation">,</span> actions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store.js'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'store.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 测试内容：mutations</span>
  <span class="token comment">// 伪造（mock）state 测试mutations下的方法</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'mutations test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
      count<span class="token punctuation">:</span><span class="token number">0</span>
    <span class="token punctuation">}</span>
    mutations<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    mutations<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 测试内容：getters</span>
  <span class="token comment">// 伪造（mock）state 测试evenOrOdd的值</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'getters test even'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">:</span><span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>getters<span class="token punctuation">.</span><span class="token function">evenOrOdd</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'even'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 测试内容：getters</span>
  <span class="token comment">// 伪造（mock）state 测试evenOrOdd的值</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'getters test odd'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">:</span><span class="token number">1</span>
        <span class="token punctuation">}</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>getters<span class="token punctuation">.</span><span class="token function">evenOrOdd</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'odd'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 测试内容：actions 比前两个测试要稍微复杂</span>
  <span class="token comment">// 伪造（mock）commit 测试mutations下的方法</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'actions test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 伪造commit</span>
    <span class="token keyword">const</span> commit <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// increment</span>
    actions<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>commit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>commit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalledWith</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span>
    <span class="token comment">// decrement</span>
    actions<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>commit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>commit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalledWith</span><span class="token punctuation">(</span><span class="token string">'decrement'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/holylovelqq/vuepress-blog/edit/master/docs/vue/VueUnitTest.md" target="_blank" rel="noopener noreferrer">帮我改进此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2019-4-17 14:20:22</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/vue/VueCommon.html" class="prev">
          VUE踩坑总结
        </a></span> <span class="next"><a href="/vue/VueAPP.html">
          VUE原生APP制作
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.53e1efa5.js" defer></script><script src="/assets/js/3.e0b6caec.js" defer></script><script src="/assets/js/29.84856ba3.js" defer></script>
  </body>
</html>
